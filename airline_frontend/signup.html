<!-- ============================================ -->
<!-- FILE LOCATION: airline-frontend/signup.html -->
<!-- FIXED VERSION - Signup button will work -->
<!-- ============================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Nimbus Airlines</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <h1>✈️ SkyWings Airlines</h1>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="login.html">Login</a></li>
                <li><a href="signup.html">Sign Up</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="auth-container">
            <h2>Create Your Account</h2>
            <form id="signupForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name *</label>
                        <input type="text" id="firstName" required placeholder="Enter first name">
                    </div>
                    <div class="form-group">
                        <label>Last Name *</label>
                        <input type="text" id="lastName" required placeholder="Enter last name">
                    </div>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="email" required placeholder="Enter email address">
                </div>
                <div class="form-group">
                    <label>Phone *</label>
                    <input type="tel" id="phone" required placeholder="Enter 10-digit phone" pattern="[0-9]{10}">
                </div>
                <div class="form-group">
                    <label>Password *</label>
                    <input type="password" id="password" required placeholder="Enter password" minlength="6">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Age</label>
                        <input type="number" id="age" min="1" max="120" placeholder="Age (optional)">
                    </div>
                    <div class="form-group">
                        <label>Gender</label>
                        <select id="gender">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Sign Up</button>
                <p class="auth-link">Already have an account? <a href="login.html">Login</a></p>
            </form>
            <div id="message"></div>
        </div>
    </div>

    <script>
        // Display message function
        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<p class="${type}">${message}</p>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        // Signup form submission
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Get form values
            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;
            const age = document.getElementById('age').value;
            const gender = document.getElementById('gender').value;
            
            // Basic validation
            if (!firstName || !lastName || !email || !phone || !password) {
                showMessage('Please fill all required fields marked with *', 'error');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }
            
            // Phone validation (10 digits)
            if (phone.length !== 10 || !/^\d{10}$/.test(phone)) {
                showMessage('Phone number must be exactly 10 digits', 'error');
                return;
            }
            
            // Password validation
            if (password.length < 6) {
                showMessage('Password must be at least 6 characters long', 'error');
                return;
            }
            
            // Create passenger object
            const passenger = {
                firstName: firstName,
                lastName: lastName,
                email: email,
                phone: phone,
                password: password,
                age: age ? parseInt(age) : null,
                gender: gender || null
            };
            
            console.log('Attempting signup with:', passenger);
            
            try {
                const response = await fetch('http://localhost:8080/api/passengers/signup', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(passenger)
                });
                
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok) {
                    showMessage('✅ Account created successfully! Redirecting to login...', 'success');
                    document.getElementById('signupForm').reset();

                    // ✅ Clear any old logged-in session
                    localStorage.removeItem('passenger');

                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);
                } else {
                    showMessage('❌ ' + (data.message || 'Signup failed. Email may already exist.'), 'error');
                }
            } catch (error) {
                console.error('Signup error:', error);
                showMessage('❌ Error connecting to server. Make sure backend is running on port 8080.', 'error');
            }
        });
    </script>
</body>
</html>

